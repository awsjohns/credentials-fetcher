app-id: org.flatpak.credentialsfetcher
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: run_credentials_fetcher_flatpak.sh
build-options:
  build-args:
    - --share=network  
modules:
  - name: credentialsfetcher
    buildsystem: simple
    build-commands:
      - install -D run_credentials_fetcher_flatpak.sh /app/bin/run_credentials_fetcher_flatpak.sh
      - install -D credentials-fetcherd /app/bin/credentials-fetcherd
      - install -d /app/lib
      - install -D * /app/lib/
      - install -D realm /app/bin/realm
      - install -D kinit /app/bin/kinit
      - install -D ldapsearch /app/bin/ldapsearch
      - install -D dig /app/bin/dig
      - install -D libdns-9.16.42-RH.so /app/bin/libdns-9.16.42-RH.so
    sources:
      - type: file
        path: run_credentials_fetcher_flatpak.sh
      - type: file
        path: ../build/credentials-fetcherd
      - type: dir
        path: libs
      - type: file
        path: /usr/sbin/realm
      - type: file
        path: /usr/bin/kinit
      - type: file
        path: /usr/bin/ldapsearch
      - type: file
        path: /usr/bin/dig
      - type: file
        path: /usr/lib64/libdns-9.16.42-RH.so
  - name: awscli
    buildsystem: simple
    build-commands:
       - install -d /app/bin
       - cp -r * /app/bin
    sources:
       - type: dir
         path: aws/aws/dist
   
  - name: sasl
    buildsystem: simple
    build-commands:
       - ls
       - install -d /app/lib/sasl2
       - cp -r * /app/lib/sasl2
    sources:
       - type: dir
         path: /usr/lib64/sasl2/  
  - name: dotnet-sdk
    buildsystem: simple
    build-commands:
      - mkdir -p /app/lib/sdk/dotnet6/{bin,lib}
      - cp -r * /app/lib/sdk/dotnet6/lib
      - ln -s /app/lib/sdk/dotnet6/lib/dotnet /app/lib/sdk/dotnet6/bin/dotnet
    sources:
      - type: archive
        only-arches: [x86_64]
        url: https://dotnetcli.blob.core.windows.net/dotnet/Sdk/6.0.416/dotnet-sdk-6.0.416-linux-x64.tar.gz
        sha256: ca612a7b1c2833016178a717761ff6ce165a13f75e5b6d8c99b068b9597898bf
        x-checker-data:
          type: html
          url: https://dotnetcli.blob.core.windows.net/dotnet/Sdk/6.0/latest.version
          version-pattern: ^([\d\.a-z-]+)$
          url-template: https://dotnetcli.blob.core.windows.net/dotnet/Sdk/$version/dotnet-sdk-$version-linux-x64.tar.gz
      - type: archive
        only-arches: [aarch64]
        url: https://dotnetcli.blob.core.windows.net/dotnet/Sdk/6.0.416/dotnet-sdk-6.0.416-linux-arm64.tar.gz
        sha256: 7a3e9944ffafb4ed7ea1b1ce14a3973e63b5d61e65dbca3b5ea665e1a628ae17
        x-checker-data:
          type: html
          url: https://dotnetcli.blob.core.windows.net/dotnet/Sdk/6.0/latest.version
          version-pattern: ^([\d\.a-z-]+)$
          url-template: https://dotnetcli.blob.core.windows.net/dotnet/Sdk/$version/dotnet-sdk-$version-linux-arm64.tar.gz
